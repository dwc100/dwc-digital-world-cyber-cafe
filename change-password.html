<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Change Password</title>
<link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/1gQKw6b/56.png">
<link rel="apple-touch-icon" sizes="180x180" href="https://i.ibb.co/1gQKw6b/56.png">

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<style>
body{font-family:Poppins,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;background:#f5f7ff;user-select:none;}
.card{width:100%;max-width:420px;padding:30px;border-radius:12px;background:white;box-shadow:0 8px 25px rgba(0,0,0,0.2);text-align:center;}
input{width:100%;padding:12px;margin:10px 0;border-radius:8px;border:1px solid #ccc;}
button{width:100%;padding:12px;border:none;background:#7d3cff;color:#fff;border-radius:8px;cursor:pointer;}
.feedback{margin-top:10px;color:red;}
</style>
</head>
<body>
<div class="card">
<h2>Change Password</h2>
<input type="password" id="newPassword" placeholder="New Password">
<input type="password" id="confirmPassword" placeholder="Confirm Password">
<button id="changeBtn">Change Password</button>
<div class="feedback" id="feedback"></div>
</div>

<script>
(async()=>{
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');
  const newPassword = document.getElementById('newPassword');
  const confirmPassword = document.getElementById('confirmPassword');
  const feedback = document.getElementById('feedback');
  const btn = document.getElementById('changeBtn');

  btn.addEventListener('click', async ()=>{
    const np = newPassword.value.trim();
    const cp = confirmPassword.value.trim();
    if(!np || !cp){ feedback.textContent='Enter both fields'; return; }
    if(np!==cp){ feedback.textContent='Passwords do not match'; return; }

    try{
      const res = await fetch('/api/change-password',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({token,newPassword:np,confirmPassword:cp})
      });
      const data = await res.json();
      if(data.success){ alert('Password changed successfully!'); window.location.href='index.html'; }
      else feedback.textContent = data.error || 'Error changing password';
    }catch(e){ feedback.textContent='Server error'; console.error(e); }
  });
})();
</script>
</body>
</html>
